#!/bin/bash -e

source $OPENSHIFT_CARTRIDGE_SDK_BASH

hostname_port='$1'
username='$2'
password='$3'
application_type='$4'
location_id='$5'

#require 'rubygems'
#require 'json'
#require 'pp'
#require 'erb'
#require 'fileutils'
#STDOUT.sync = true
#STDERR.sync = true

#@application_erb = "#{ENV['OPENSHIFT_REPO_DIR']}/configuration/application_template.json.erb"
#@hostname_port = ARGV[0]
#@username = ARGV[1]
#@password = ARGV[2]
#@application_type = ARGV[3]
#@location_id = ARGV[4]

def create_application
  #erb = ERB.new(File.open(@application_erb, "rb").read)
  #application_template_json = "#{ENV['OPENSHIFT_REPO_DIR']}/configuration/application_template.json.erb"
  #File.open(application_template_json, 'w') {|f| f.write(erb.result(binding)) }
  #FileUtils.rm @application_erb
  status_code = `curl -s -X POST -H "Content-Type: application/json" -d { "type": "${application_type}", "locations": [ "/v1/locations/${location_id}" ] } --insecure https://${username}:${password}@${hostname_port}/v1/applications`
  if status_code != '200'
    exit 1
  end
end

create_application